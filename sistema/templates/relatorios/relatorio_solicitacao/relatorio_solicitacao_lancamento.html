{% include 'relatorios/estrutura/style.html' %}
<div class="page-wrapper">
  <div class="page body">
    <div class="container">
      <div class="watermark">
        <img src="{{logo_path}}"
          alt="Jaquirana Extração Watermark" />
      </div>

      <div class="content">
        <div class="header no-break">
          <img src="{{logo_path}}"
            alt="Logo Jaquirana Extração" />
          <div class="system-info">
            <div><strong>Sistema de Gestão Jaquirana</strong></div>
            <div><strong>Versão</strong> {{changelog.versao}}</div>
            <div><strong>Data:</strong> {{changelog.data_lancamento}}</div>
          </div>
        </div>
        <div class="dados-registro no-break">
          <div
            style="display: flex; flex-wrap: wrap; justify-content: space-between;">
            <div style="flex: 1 1 48%; margin-bottom: 10px;">
              <p><span class="label"><strong>ID da Carga:</strong></span>
                #{{carga.id}}</p>
              <p><span class="label"><strong>Cliente:</strong></span>
                {{carga.cliente.identificacao}}</p>
              {% if carga.floresta_id %}
              <p><span class="label"><strong>Floresta:</strong></span>
                {{carga.floresta.identificacao}}</p>
              {% elif carga.fornecedor_id %}
              <p><span class="label"><strong>Fornecedor:</strong></span>
                {{carga.fornecedor.identificacao}}</p>
              {% else %}
              <p><span class="label"><strong>Origem:</strong></span> -</p>
              {% endif %}
            </div>

            <div style="flex: 1 1 48%; margin-bottom: 10px;">
              <p><span class="label"><strong>Ativo:</strong></span> {% if
                carga.ativo == True %}Sim{% else %}Não{% endif %}</p>
              <p><span class="label"><strong>Data da Emissão:</strong></span>
                {{dataHoje}}</p>
              <p><span class="label"><strong>Usuário
                    Responsável:</strong></span>
                {{carga.usuario.nome}}</p>
            </div>
          </div>
        </div>

        {% if carga.cancelada == True %}
        <div class="status-relatorio no-break"
          style="background-color: #f7e0e0; color: #721c24;">
          Esta carga foi CANCELADA!
        </div>
        {% endif %}

        <!-- Seção de Informações do Produto -->
        <div class="section-title"><strong>Informações do Produto</strong></div>
        <div class="card-section">
          <div class="card">
            <div class="card-title"><strong>Características do
                Material</strong></div>
            <p><span class="label"><strong>Tipo de Madeira:</strong></span>
              {{carga.produto.nome}}</p>
            <p><span class="label"><strong>Bitola:</strong></span>
              {{carga.bitola.bitola}}</p>
          </div>
        </div>

        <div class="section-title"><strong>Informações de
            Transporte</strong></div>
        <div class="card-section">
          <div class="card">
            <div class="card-title"><strong>Motorista</strong></div>
            <p><span class="label"><strong>Nome:</strong></span>
              {{carga.motorista.nome_completo}}</p>
            <p><span class="label"><strong>CPF:</strong></span>
              {{carga.motorista.cpf}}</p>
            <p><span class="label"><strong>Telefone:</strong></span>
              {{carga.motorista.celular}}</p>
          </div>

          <div class="card">
            <div class="card-title"><strong>Dados do Veículo</strong></div>
            <p><span class="label"><strong>Placa:</strong></span>
              {{carga.veiculo.placa_veiculo}}</p>
            <p><span class="label"><strong>Transportadora:</strong></span>
              {{carga.motorista.transportadora.identificacao}}</p>
            <p><span class="label"><strong>Capacidade (Ton.):</strong></span>
              {{carga.veiculo.capacidade_ton}}</p>
          </div>
        </div>

        <div class="section-title"><strong>Status de Documentação</strong></div>
        <div class="card-section">
          <div class="card">
            <div class="card-title"><strong>Situação</strong></div>
            <p><span class="label"><strong>Nota Fiscal Emitida:</strong></span>
              {% if carga.nf_emitida == True %}Sim{% else %}Não{% endif %}</p>
            <p><span class="label"><strong>Ticket Emitido:</strong></span>
              {% if carga.ticket_emitido == True %}Sim{% else %}Não{% endif
              %}</p>
          </div>

          {% if carga.grupo_whats_id %}
          <div class="card">
            <div class="card-title"><strong>Comunicação</strong></div>
            <p><span class="label"><strong>Grupo WhatsApp:</strong></span>
              {{carga.grupo_whats.nome_grupo_whats}}</p>
            <p><span class="label"><strong>Data/Hora Mensagem:</strong></span>
              {% if carga.data_hora_msg_whats %}
              {{carga.data_hora_msg_whats | formatar_data_hora}}
              {% else %}
              Não enviada
              {% endif %}
            </p>
          </div>
          {% endif %}
        </div>

        {% if cargas_relacionadas %}
        <div class="section-title"><strong>Histórico de Cargas
            Relacionadas</strong></div>
        <table>
          <thead>
            <tr>
              <th><strong>ID</strong></th>
              <th><strong>Data</strong></th>
              <th><strong>Cliente</strong></th>
              <th><strong>Origem</strong></th>
              <th><strong>Produto</strong></th>
              <th><strong>Bitola</strong></th>
              <th><strong>Status</strong></th>
            </tr>
          </thead>
          <tbody>
            {% for c in cargas_relacionadas %}
            {% if c.id != carga.id %}
            <tr>
              <td>{{ c.id }}</td>
              <td>{{ c.data_cadastro | formatar_data_hora }}</td>
              <td>{{ c.cliente.identificacao }}</td>
              <td>
                {% if c.floresta_id %}
                {{ c.floresta.identificacao }}
                {% elif c.fornecedor_id %}
                {{ c.fornecedor.identificacao }}
                {% else %}
                -
                {% endif %}
              </td>
              <td>{{ c.produto.nome|default('-') }}</td>
              <td>{{ c.bitola.bitola|default('-') }}</td>
              <td>
                {% if c.cancelada %}
                <span style="color: #721c24;">Cancelada</span>
                {% elif c.nf_emitida and c.ticket_emitido %}
                <span style="color: #155724;">Completa</span>
                {% elif c.nf_emitida %}
                <span style="color: #856404;">NF Emitida</span>
                {% elif c.ticket_emitido %}
                <span style="color: #856404;">Ticket Emitido</span>
                {% else %}
                <span style="color: #0c5460;">Pendente</span>
                {% endif %}
              </td>
            </tr>
            {% endif %}
            {% endfor %}
          </tbody>
        </table>
        {% endif %}

        <div class="footer">
          <p><strong>Jaquirana Extração &copy; 2025</strong> - Todos os direitos
            reservados</p>
          <p><strong>Sistema de Gestão Jaquirana</strong></p>
        </div>
      </div>
    </div>
  </div>
</div>