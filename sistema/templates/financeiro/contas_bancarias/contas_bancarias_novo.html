{% extends 'estrutura/base.html' %}
{% block conteudo %}
{% include 'estrutura/header.html' %}

<!-- CSS espec√≠fico da p√°gina -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/contas-bancarias.css') }}">

<div class="page-wrapper">

  <div class="page-header d-print-none">
    <div class="container-xl">
      <div class="row g-2 align-items-center">
        <div class="col">
          <div class="page-pretitle text-muted">FINANCEIRO</div>
          <h2 class="page-title fw-bold display-6 page-title-madeireira">CONTAS BANC√ÅRIAS</h2>
        </div>
        <div class="col-auto ms-auto d-print-none">
          <div class="d-flex gap-2">
            {% set conta_id_para_link = conta_selecionada_id %}
            {% if not conta_id_para_link %}
              {% for conta in contas_bancarias %}
                {% if conta.conta_principal %}
                  {% set conta_id_para_link = conta.id %}
                {% endif %}
              {% endfor %}
            {% endif %}
            <a href="{% if transacoes_nao_conciliadas > 0 and conta_id_para_link %}{{ url_for('conciliacao_ofx', conta_id=conta_id_para_link) }}{% else %}{{ url_for('importar_ofx') }}{% if conta_id_para_link %}?conta_bancaria_id={{ conta_id_para_link }}{% endif %}{% endif %}"
              class="btn btn-madeireira">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="icon icon-tabler icons-tabler-outline icon-tabler-file-arrow-right">
                <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                <path d="M14 3v4a1 1 0 0 0 1 1h4" />
                <path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" />
                <path d="M9 15h6" />
                <path d="M12.5 17.5l2.5 -2.5l-2.5 -2.5" />
              </svg>
              {%if transacoes_nao_conciliadas > 0%}Conciliar{%else%}Importar{%endif%} OFX
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="page-body py-4">
    <div class="container-xl">
      {% include 'estrutura/mensagens_flash.html' %}

      <!-- Layout Principal com Contas Banc√°rias -->
      <div class="row">
        <!-- Sidebar com Contas Banc√°rias -->
        <div class="col-lg-3">
          <div class="card shadow-sm border-0 rounded-3 mb-4">
            <div class="card-header card-header-gradient">
              <h4 class="card-title mb-0">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-2">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                  <path
                    d="M17 8v-3a1 1 0 0 0 -1 -1h-10a2 2 0 0 0 0 4h12a1 1 0 0 1 1 1v3m0 4v3a1 1 0 0 1 -1 1h-12a2 2 0 0 1 -2 -2v-12" />
                  <path d="M20 12v4h-4a2 2 0 0 1 0 -4h4" />
                </svg>
                Contas Banc√°rias
              </h4>
            </div>
            <div class="card-body p-0">
              <!-- Lista de Contas -->
              <div class="list-group list-group-flush">
                {% if contas_bancarias %}
                {% for conta in contas_bancarias %}
                <div
                  class="list-group-item border-0 conta-bancaria cursor-pointer {% if conta_selecionada_id == conta.id or (not conta_selecionada_id and conta.conta_principal) %}bg-green-lt{% endif %}"
                  data-conta="{{ conta.id }}" data-nome="{{ conta.identificacao }}">
                  <div class="d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center">
                      <div>
                        <div class="fw-bold">{{ conta.identificacao }}</div>
                        <small class="text-muted">
                          {% if conta_selecionada_id == conta.id or (not conta_selecionada_id and conta.conta_principal) %}
                          Conta Selecionada
                          {% else %}
                          {% if conta.tipo_conta %}{{ conta.tipo_conta }}{% else %}Conta Banc√°ria{% endif %}
                          {% endif %}
                        </small>
                      </div>
                    </div>
                    <div class="text-end">
                      {% set ns = namespace(saldo_conta = 0) %}
                      {% if conta.conta_bancaria_saldo %}
                        {% for saldo in conta.conta_bancaria_saldo %}
                          {% if saldo.ativo and not saldo.deletado %}
                            {% set ns.saldo_conta = saldo.valor_total_saldo_100 %}
                          {% endif %}
                        {% endfor %}
                      {% endif %}
                      <div class="fw-bold {% if ns.saldo_conta >= 0 %}text-success{% else %}text-danger{% endif %}">
                        {{ ns.saldo_conta | formatar_float_para_brl }}
                      </div>
                      <!-- Debug: {{ conta.conta_bancaria_saldo|length if conta.conta_bancaria_saldo else 'sem saldo' }} -->
                    </div>
                  </div>
                </div>
                {% endfor %}
                {% else %}
                <div class="list-group-item border-0 text-center py-4">
                  <div class="text-muted">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none"
                      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                      class="mb-3">
                      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                      <path
                        d="M17 8v-3a1 1 0 0 0 -1 -1h-10a2 2 0 0 0 0 4h12a1 1 0 0 1 1 1v3m0 4v3a1 1 0 0 1 -1 1h-12a2 2 0 0 1 -2 -2v-12" />
                      <path d="M20 12v4h-4a2 2 0 0 1 0 -4h4" />
                    </svg>
                    <div>Nenhuma conta banc√°ria cadastrada</div>
                  </div>
                </div>
                {% endif %}
              </div>

              <!-- Totais -->
              {% if contas_bancarias %}
              <div class="border-top pt-3 px-3 pb-3">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <span class="text-muted">Total Geral</span>
                  <span class="fw-bold fs-4 {% if saldo_total_contas >= 0 %}text-success{% else %}text-danger{% endif %}">
                    {{ saldo_total_contas | formatar_float_para_brl }}
                  </span>
                </div>
              </div>
              {% endif %}
            </div>
          </div>
        </div>

        <!-- √Årea Principal do Extrato -->
        <div class="col-lg-9">
          <!-- Cards de Informa√ß√µes -->
          <div class="row row-cards mb-4">
            <div class="col-md-6 col-lg-4">
              <div class="card border shadow-lg rounded-3 card-border-madeireira">
                <div class="card-body d-flex align-items-center">
                  <span class="avatar text-white me-3 avatar-madeireira">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                      <path
                        d="M17 8v-3a1 1 0 0 0 -1 -1h-10a2 2 0 0 0 0 4h12a1 1 0 0 1 1 1v3m0 4v3a1 1 0 0 1 -1 1h-12a2 2 0 0 1 -2 -2v-12" />
                      <path d="M20 12v4h-4a2 2 0 0 1 0 -4h4" />
                    </svg>
                  </span>
                  <div>
                    <div class="text-uppercase text-muted fw-semibold">Saldo Atual</div>
                    <div class="fs-3 fw-bold mt-1 text-madeireira">{{saldo_disponivel |
                      formatar_float_para_brl}}</div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-md-6 col-lg-4">
              <div class="card border shadow-lg rounded-3 card-border-madeireira">
                <div class="card-body d-flex align-items-center">
                  <span class="avatar text-white me-3 avatar-madeireira">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                      <path d="M7 9m0 2a2 2 0 0 1 2 -2h6a2 2 0 0 1 2 2v6a2 2 0 0 1 -2 2h-6a2 2 0 0 1 -2 -2z" />
                      <path d="M14 14m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" />
                      <path d="M17 9v-2a2 2 0 0 0 -2 -2h-6a2 2 0 0 0 -2 2v6a2 2 0 0 0 2 2h2" />
                    </svg>
                  </span>
                  <div>
                    <div class="text-uppercase text-muted fw-semibold">Total Recebido</div>
                    <div class="fs-3 fw-bold mt-1 text-madeireira">{{total_recebido | formatar_float_para_brl}}
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-md-6 col-lg-4">
              <div class="card border shadow-lg rounded-3 card-border-madeireira">
                <div class="card-body d-flex align-items-center">
                  <span class="avatar text-white me-3 avatar-madeireira">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                      <path
                        d="M17 8v-3a1 1 0 0 0 -1 -1h-10a2 2 0 0 0 0 4h12a1 1 0 0 1 1 1v3m0 4v3a1 1 0 0 1 -1 1h-12a2 2 0 0 1 -2 -2v-12" />
                      <path d="M20 12v4h-4a2 2 0 0 1 0 -4h4" />
                      <path d="M13 10l-2 2l2 2" />
                    </svg>
                  </span>
                  <div>
                    <div class="text-uppercase text-muted fw-semibold">Total Pago</div>
                    <div class="fs-3 fw-bold mt-1 text-madeireira">{{valor_total_pago |
                      formatar_float_para_brl}}</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Extrato de Movimenta√ß√µes Banc√°rias -->
          <div class="row mt-4">
            <div class="col">
              <div class="card shadow-sm border-0 rounded-3">
                <div class="card-body p-0">
                  {%if movimentacoes != []%}
                  <ul class="list-group list-group-flush">
                    {% for mov in movimentacoes %}
                    <li class="list-group-item py-3 px-4">
                      <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center gap-3">

                          {% if mov.tipo_movimentacao == 2 %}
                          <span class="text-danger">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                              fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                              stroke-linejoin="round"
                              class="icon icon-tabler icons-tabler-outline icon-tabler-arrow-down">
                              <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                              <path d="M12 5l0 14" />
                              <path d="M18 13l-6 6" />
                              <path d="M6 13l6 6" />
                            </svg>
                          </span>
                          {% elif mov.tipo_movimentacao == 1 %}
                          <span class="text-success">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                              fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                              stroke-linejoin="round"
                              class="icon icon-tabler icons-tabler-outline icon-tabler-arrow-up">
                              <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                              <path d="M12 5l0 14" />
                              <path d="M18 11l-6 -6" />
                              <path d="M6 11l6 -6" />
                            </svg>
                          </span>
                          {% elif mov.tipo_movimentacao == 3 %}
                          <span class="text-success">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                              fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                              stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-x">
                              <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                              <path d="M18 6l-12 12" />
                              <path d="M6 6l12 12" />
                            </svg>
                          </span>
                          {% elif mov.tipo_movimentacao == 4 %}
                          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="icon icon-tabler icons-tabler-outline icon-tabler-currency-dollar">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                            <path d="M16.7 8a3 3 0 0 0 -2.7 -2h-4a3 3 0 0 0 0 6h4a3 3 0 0 1 0 6h-4a3 3 0 0 1 -2.7 -2" />
                            <path d="M12 3v3m0 12v3" />
                          </svg>
                          {% elif mov.tipo_movimentacao == 5 %}
                          <span class="text-success">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                              fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                              stroke-linejoin="round"
                              class="icon icon-tabler icons-tabler-outline icon-tabler-arrow-up">
                              <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                              <path d="M12 5l0 14" />
                              <path d="M18 11l-6 -6" />
                              <path d="M6 11l6 -6" />
                            </svg>
                          </span>
                          {% endif %}

                          <div>

                            <div class="fw-semibold">
                              {% if mov.tipo_movimentacao == 1 %}
                              {% if mov.conciliacao_bancaria and mov.importacao_ofx %}
                              {% if mov.recebimentos_massa is defined and mov.recebimentos_massa|length > 0 %}
                              <div class="d-flex align-items-center">
                                <span>Recebimento cliente</span>
                                <button type="button" class="btn btn-sm btn-ghost-dark ms-2 p-1" data-bs-toggle="modal"
                                  data-bs-target="#modalRecebimentos{{ mov.id }}" title="Ver detalhes">
                                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                    <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
                                    <path
                                      d="M21 12c-2.4 4 -5.4 6 -9 6c-3.6 0 -6.6 -2 -9 -6c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6" />
                                  </svg>
                                  <span class="ms-1">{{ mov.recebimentos_massa|length }} transa√ß√µes</span>
                                </button>
                              </div>
                              {% elif mov.conciliacao_faturamento %}
                              Recebimento: {{ mov.conciliacao_faturamento.codigo_faturamento }}
                              {% elif mov.conciliacao_lancamento_avulso %}
                              Receita extra conciliada: {{ mov.conciliacao_lancamento_avulso.descricao }}
                              {% else %}
                              Receita extra conciliada
                              {% endif %}
                              {% elif mov.conciliacao_faturamento %}
                              Recebimento: {{ mov.conciliacao_faturamento.codigo_faturamento }}
                              {% elif mov.agendamento and mov.agendamento.situacao_pagamento_id == 9 %}
                              Liquida√ß√£o de receita: {{ mov.agendamento.descricao or mov.agendamento.referencia or
                              "Receita liquidada" }}
                              {% elif mov.observacao_movimentacao %}
                              {{ mov.observacao_movimentacao }}
                              {%else%}
                              Receita avulsa: {{mov.conciliacao_lancamento_avulso.descricao if
                              mov.conciliacao_lancamento_avulso else "Entrada"}}
                              {% endif %}

                              {% elif mov.tipo_movimentacao == 2 %}
                              {% if mov.conciliacao_bancaria and mov.importacao_ofx %}
                              {% if mov.fornecedores_pagos_massa is defined and mov.fornecedores_pagos_massa|length > 0
                              %}
                              <div class="d-flex align-items-center">
                                <span>Pagamento fornecedor</span>
                                <button type="button" class="btn btn-sm btn-ghost-dark ms-2 p-1" data-bs-toggle="modal"
                                  data-bs-target="#modalFornecedores{{ mov.id }}" title="Ver detalhes">
                                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                    <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
                                    <path
                                      d="M21 12c-2.4 4 -5.4 6 -9 6c-3.6 0 -6.6 -2 -9 -6c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6" />
                                  </svg>
                                  <span class="ms-1">{{ mov.fornecedores_pagos_massa|length }} transa√ß√µes</span>
                                </button>
                              </div>
                              {% elif mov.transportadoras_pagas_massa is defined and
                              mov.transportadoras_pagas_massa|length > 0 %}
                              <div class="d-flex align-items-center">
                                <span>Pagamento transportadora</span>
                                <button type="button" class="btn btn-sm btn-ghost-dark ms-2 p-1" data-bs-toggle="modal"
                                  data-bs-target="#modalTransportadoras{{ mov.id }}" title="Ver detalhes">
                                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                    <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
                                    <path
                                      d="M21 12c-2.4 4 -5.4 6 -9 6c-3.6 0 -6.6 -2 -9 -6c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6" />
                                  </svg>
                                  <span class="ms-1">{{ mov.transportadoras_pagas_massa|length }} transa√ß√µes</span>
                                </button>
                              </div>
                              {% elif mov.extratores_pagos_massa is defined and mov.extratores_pagos_massa|length > 0 %}
                              <div class="d-flex align-items-center">
                                <span>Pagamento extrator</span>
                                <button type="button" class="btn btn-sm btn-ghost-dark ms-2 p-1" data-bs-toggle="modal"
                                  data-bs-target="#modalExtratores{{ mov.id }}" title="Ver detalhes">
                                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                    <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
                                    <path
                                      d="M21 12c-2.4 4 -5.4 6 -9 6c-3.6 0 -6.6 -2 -9 -6c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6" />
                                  </svg>
                                  <span class="ms-1">{{ mov.extratores_pagos_massa|length }} transa√ß√µes</span>
                                </button>
                              </div>
                              {% elif mov.comissionados_pagos_massa is defined and mov.comissionados_pagos_massa|length
                              > 0 %}
                              <div class="d-flex align-items-center">
                                <span>Pagamento comissionado</span>
                                <button type="button" class="btn btn-sm btn-ghost-dark ms-2 p-1" data-bs-toggle="modal"
                                  data-bs-target="#modalComissionados{{ mov.id }}" title="Ver detalhes">
                                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                    <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
                                    <path
                                      d="M21 12c-2.4 4 -5.4 6 -9 6c-3.6 0 -6.6 -2 -9 -6c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6" />
                                  </svg>
                                  <span class="ms-1">{{ mov.comissionados_pagos_massa|length }} transa√ß√µes</span>
                                </button>
                              </div>
                              {% elif mov.conciliacao_lancamento_avulso %}
                              Despesa extra conciliada: {{mov.conciliacao_lancamento_avulso.descricao}}
                              {% elif mov.fornecedor_pagamento %}
                              Pagamento de fornecedor: {{ mov.fornecedor_pagamento.fornecedor.identificacao }}
                              {% elif mov.freteiro_pagamento %}
                              Pagamento freteiro: {{ mov.freteiro_pagamento.transportadora.identificacao }}
                              {% elif mov.extrator_pagamento %}
                              Pagamento extrator: {{ mov.extrator_pagamento.fornecedor.extrator.identificacao }}
                              {% elif mov.comissionado_pagamento %}
                              Pagamento comissionado: {{ mov.comissionado_pagamento.comissionado.identificacao }}
                              {% else %}
                              Pagamento conciliado
                              {% endif %}
                              {% elif mov.agendamento and mov.agendamento.situacao_pagamento_id == 9 %}
                              Liquida√ß√£o de despesa: {{ mov.agendamento.descricao or mov.agendamento.referencia or
                              "Despesa liquidada" }}
                              {% elif mov.conciliacao_lancamento_avulso %}
                              Despesa avulsa: {{mov.conciliacao_lancamento_avulso.descricao}}
                              {% elif mov.credito_extrator %}
                              Inclus√£o de cr√©dito: Extrator {{ mov.credito_extrator.extrator.identificacao }}
                              {% elif mov.credito_fornecedor %}
                              Inclus√£o de cr√©dito: Fornecedor {{ mov.credito_fornecedor.fornecedor.identificacao }}
                              {% elif mov.credito_freteiro %}
                              Inclus√£o de cr√©dito: Freteiro {{ mov.credito_freteiro.transportadora.identificacao }}
                              {% elif mov.fornecedor_pagamento %}
                              Pagamento de fornecedor: {{ mov.fornecedor_pagamento.fornecedor.identificacao }}
                              {% elif mov.freteiro_pagamento %}
                              Pagamento freteiro: {{ mov.freteiro_pagamento.transportadora.identificacao }}
                              {% elif mov.extrator_pagamento %}
                              Pagamento extrator: {{ mov.extrator_pagamento.fornecedor.extrator.identificacao }}
                              {% elif mov.comissionado_pagamento %}
                              Pagamento comissionado: {{ mov.comissionado_pagamento.comissionado.identificacao }}
                              {%elif mov.observacao_movimentacao%}
                              {{ mov.observacao_movimentacao }}
                              {% else %}
                              Movimenta√ß√£o gen√©rica
                              {% endif %}

                              {% elif mov.tipo_movimentacao == 3 %}
                              Cancelamento de movimenta√ß√£o

                              {% elif mov.tipo_movimentacao == 4 %}
                              {% if mov.credito_fornecedor %}
                              Estorno de cr√©dito de fornecedor: {{ mov.credito_fornecedor.fornecedor.identificacao }}
                              {% elif mov.credito_extrator %}
                              Estorno de cr√©dito de extrator: {{ mov.credito_extrator.extrator.identificacao }}
                              {% elif mov.credito_freteiro %}
                              Estorno de cr√©dito de freteiro: {{ mov.credito_freteiro.transportadora.identificacao }}
                              {% else %}
                              Estorno de cr√©dito gen√©rico
                              {% endif %}

                              {% elif mov.tipo_movimentacao == 5 %}
                              Estorno de saldo de conta

                              {% else %}
                              Movimenta√ß√£o desconhecida
                              {% endif %}
                            </div>

                            <small class="text-muted">
                              {{ mov.data_movimentacao.strftime('%d/%m/%Y') }} ‚Ä¢
                              {%if mov.tipo_movimentacao == 1 and
                              mov.conciliacao_lancamento_avulso %}
                              {% if mov.conciliacao_bancaria and mov.importacao_ofx %}Receita conciliada{% else
                              %}Receita
                              por lan√ßamento{% endif %}
                              {% elif mov.tipo_movimentacao == 1 %}
                              Entrada
                              {% elif mov.tipo_movimentacao == 2 and
                              mov.conciliacao_lancamento_avulso %}
                              {% if mov.conciliacao_bancaria and mov.importacao_ofx %}Despesa conciliada{% else
                              %}Despesa
                              por lan√ßamento{% endif %}
                              {% elif mov.tipo_movimentacao == 2 %}
                              Sa√≠da
                              {% elif mov.tipo_movimentacao == 3 %}
                              Cancelamento
                              {% elif mov.tipo_movimentacao == 4 %}
                              Estorno de cr√©dito
                              {% elif mov.tipo_movimentacao == 5 %}
                              Estorno de saldo
                              {% endif %}
                            </small>
                            <small class="text-muted">
                              {%if mov.conciliacao_bancaria and mov.importacao_ofx_id%}
                              ‚Ä¢ FTID: {{ mov.importacao_ofx.fitid }}
                              {% endif %}
                            </small>
                          </div>

                        </div>

                        <div class="text-end">
                          {% set valor = 0 %}

                          {% if mov.conciliacao_bancaria and mov.importacao_ofx and mov.valor_movimentacao_100 %}
                          {% set valor = mov.valor_movimentacao_100 %}
                          {% elif mov.recebimento %}
                          {% set valor = mov.recebimento.valor_total_recebimento_100 or 0 %}
                          {% elif mov.credito_extrator %}
                          {% set valor = mov.credito_extrator.valor_credito_100 or 0 %}
                          {% elif mov.credito_fornecedor %}
                          {% set valor = mov.credito_fornecedor.valor_credito_100 or 0 %}
                          {% elif mov.credito_freteiro %}
                          {% set valor = mov.credito_freteiro.valor_credito_100 or 0 %}
                          {% elif mov.fornecedor_pagamento %}
                          {% if mov.movimentacao_extra %}
                          {% set valor = mov.valor_movimentacao_100 or 0 %}
                          {% else %}
                          {% set valor = mov.fornecedor_pagamento.valor_total_a_pagar_100 or 0 %}
                          {% endif %}
                          {% elif mov.freteiro_pagamento %}
                          {% if mov.movimentacao_extra %}
                          {% set valor = mov.valor_movimentacao_100 or 0 %}
                          {% else %}
                          {% set valor = mov.freteiro_pagamento.valor_total_a_pagar_100 or 0 %}
                          {% endif %}
                          {% elif mov.extrator_pagamento %}
                          {% if mov.movimentacao_extra %}
                          {% set valor = mov.valor_movimentacao_100 or 0 %}
                          {% else %}
                          {% set valor = mov.extrator_pagamento.valor_total_a_pagar_100 or 0 %}
                          {% endif %}
                          {% elif mov.comissionado_pagamento %}
                          {% if mov.movimentacao_extra %}
                          {% set valor = mov.valor_movimentacao_100 or 0 %}
                          {% else %}
                          {% set valor = mov.comissionado_pagamento.valor_total_a_pagar_100 or 0 %}
                          {% endif %}
                          {% elif mov.conciliacao_lancamento_avulso %}
                          {% set valor = mov.conciliacao_lancamento_avulso.valor_movimentacao_100 or 0 %}
                          {% elif mov.agendamento and mov.agendamento.situacao_pagamento_id == 9 %}
                          {% set valor = mov.valor_movimentacao_100 or 0 %}
                          {% else %}
                          {% set valor = mov.valor_movimentacao_100 or 0 %}
                          {% endif %}

                          <div class="{% if mov.tipo_movimentacao == 1 %}text-success
         {% elif mov.tipo_movimentacao == 2 %}text-danger
         {% elif mov.tipo_movimentacao == 3 %}text-warning
         {% elif mov.tipo_movimentacao == 4 %}text-primary
         {% elif mov.tipo_movimentacao == 5 %}text-success
         {% endif %} fw-bold">
                            {{ '+' if mov.tipo_movimentacao == 1 else
                            '-' if mov.tipo_movimentacao == 2 else
                            '√ó' if mov.tipo_movimentacao == 3 else
                            '‚Ü∫' }} {{ valor | formatar_float_para_brl }}
                          </div>

                          <div class="d-flex flex-column align-items-end gap-1">
                            <span class="badge
                        {% if mov.tipo_movimentacao == 1 %}bg-success-lt text-success
                        {% elif mov.tipo_movimentacao == 2 %}bg-danger-lt text-danger
                        {% elif mov.tipo_movimentacao == 3 %}bg-warning-lt text-warning
                        {% elif mov.tipo_movimentacao == 4 %}bg-primary-lt text-primary
                        {% elif mov.tipo_movimentacao == 5 %}bg-success-lt text-success
                        {% endif %}">
                              {% if mov.conciliacao_bancaria and mov.importacao_ofx and
                              mov.conciliacao_lancamento_avulso %}
                              {% if mov.tipo_movimentacao == 1 %}Receita conciliada{% else %}Despesa conciliada{% endif
                              %}
                              {% elif mov.agendamento and mov.agendamento.situacao_pagamento_id == 9 %}
                              {% if mov.tipo_movimentacao == 1 %}Liquida√ß√£o de receita{% else %}Liquida√ß√£o de despesa{%
                              endif %}
                              {% else %}
                              {{"Entrada por lan√ßamento" if
                              mov.conciliacao_lancamento_avulso and mov.tipo_movimentacao
                              == 1 else
                              "Entrada" if mov.tipo_movimentacao == 1 else
                              "Sa√≠da por lan√ßamento" if mov.conciliacao_lancamento_avulso
                              and mov.tipo_movimentacao == 2 else
                              "Sa√≠da" if mov.tipo_movimentacao == 2 else
                              "Cancelamento" if mov.tipo_movimentacao == 3 else
                              "Estorno" }}
                              {% endif %}
                            </span>

                            {%if mov.conciliacao_bancaria and mov.importacao_ofx%}
                            <span
                              class="badge {% if mov.tipo_movimentacao == 1 %}bg-success-lt text-success{% else %}bg-danger-lt text-danger{% endif %}">
                              Conciliado OFX
                            </span>
                            {% endif %}
                          </div>

                        </div>
                      </div>
                    </li>
                    {% endfor %}
                  </ul>

                  {%else%}
                  <div class="area-info-extrato">
                    <div class="icon-extrato">
                      üìÑ
                    </div>
                    <h2>
                      Nenhuma Movimenta√ß√£o encontrada
                    </h2>
                    <p>
                      N√£o encontramos movimenta√ß√µes para serem exibidos no
                      momento.
                    </p>
                  </div>
                  {%endif%}
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- Modal para Filtros do Extrato -->
      <div class="modal modal-blur fade" id="modal-filtros-extrato" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
          <form id="filtroExtratoForm" method="get">
            <div class="modal-content">
              <div class="modal-header modal-header-madeireira">
                <h5 class="modal-title fw-bold">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-2">
                    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                    <path
                      d="M4 4h16v2.172a2 2 0 0 1 -.586 1.414l-4.414 4.414v7l-6 2v-8.5l-4.48 -4.928a2 2 0 0 1 -.52 -1.345v-2.227z" />
                  </svg>
                  Filtros do Extrato Banc√°rio
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                  aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <div class="row g-3">
                  <!-- Conta Banc√°ria -->
                  <div class="col-md-6">
                    <label class="form-label fw-semibold">Conta Banc√°ria</label>
                    <select class="form-select" name="conta_bancaria_id">
                      <option value="">Todas as contas</option>
                      {% for conta in contas_bancarias %}
                      <option value="{{ conta.id }}" {% if conta_selecionada_id==conta.id %}selected{% endif %}>
                        {{ conta.identificacao }}
                      </option>
                      {% endfor %}
                    </select>
                  </div>

                  <!-- Tipo de Movimenta√ß√£o -->
                  <div class="col-md-6">
                    <label class="form-label fw-semibold">Tipo de Movimenta√ß√£o</label>
                    <select class="form-select" name="tipo_movimentacao">
                      <option value="">Todos os tipos</option>
                      <option value="1">Entradas</option>
                      <option value="2">Sa√≠das</option>
                    </select>
                  </div>

                  <!-- Data Inicial -->
                  <div class="col-md-6">
                    <label class="form-label fw-semibold">Data Inicial</label>
                    <input type="date" class="form-control" name="data_inicial">
                  </div>

                  <!-- Data Final -->
                  <div class="col-md-6">
                    <label class="form-label fw-semibold">Data Final</label>
                    <input type="date" class="form-control" name="data_final">
                  </div>

                  <!-- Valor M√≠nimo -->
                  <div class="col-md-6">
                    <label class="form-label fw-semibold">Valor M√≠nimo</label>
                    <input type="text" class="form-control campo-moeda-brl" name="valor_minimo" placeholder="R$ 0,00">
                  </div>

                  <!-- Valor M√°ximo -->
                  <div class="col-md-6">
                    <label class="form-label fw-semibold">Valor M√°ximo</label>
                    <input type="text" class="form-control campo-moeda-brl" name="valor_maximo" placeholder="R$ 0,00">
                  </div>

                  <!-- Status Concilia√ß√£o -->
                  <div class="col-md-6">
                    <label class="form-label fw-semibold">Status de Concilia√ß√£o</label>
                    <select class="form-select" name="status_conciliacao">
                      <option value="">Todos os status</option>
                      <option value="1">Conciliado</option>
                      <option value="0">N√£o Conciliado</option>
                    </select>
                  </div>

                  <!-- Ordena√ß√£o -->
                  <div class="col-md-6">
                    <label class="form-label fw-semibold">Ordenar Por</label>
                    <select class="form-select" name="ordenacao">
                      <option value="data_desc">Data (Mais Recente)</option>
                      <option value="data_asc">Data (Mais Antiga)</option>
                      <option value="valor_desc">Valor (Maior)</option>
                      <option value="valor_asc">Valor (Menor)</option>
                    </select>
                  </div>
                </div>
              </div>
              <div class="modal-footer">
                <a href="{{url_for('conciliacao_contas_bancarias')}}" class="btn btn-link link-secondary">
                  Limpar Filtros
                </a>
                <button type="submit" class="btn btn-madeireira">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-1">
                    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                    <path d="M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0" />
                    <path d="M21 21l-6 -6" />
                  </svg>
                  Aplicar Filtros
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>

<!-- JavaScript espec√≠fico da p√°gina -->
<script src="{{ url_for('static', filename='js/pages/contas-bancarias.js') }}"></script>

{% endblock conteudo %}